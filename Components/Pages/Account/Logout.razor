@page "/account/logout"
@inject NavigationManager Navigation
@inject IJSRuntime JS
@inject IHttpContextAccessor HttpContextAccessor

<PageTitle>Logging out...</PageTitle>

<div class="flex items-center justify-center min-h-screen">
    <div class="text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
        <p class="text-text-secondary dark:text-gray-400">Logging out...</p>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Use JS Interop to call the logout API which clears cookies
            await JS.InvokeVoidAsync("auth.logout");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Logout error: {ex.Message}");
            // Even if API fails, try to redirect
            Navigation.NavigateTo("/login", forceLoad: true);
        }
    }
}

<script>
    if (!window.auth) window.auth = {};
    window.auth.logout = async () => {
        try {
            await fetch('/api/auth/logout', { method: 'POST' });
            window.location.href = '/login';
        } catch (e) {
            console.error(e);
            window.location.href = '/login';
        }
    };
</script>
